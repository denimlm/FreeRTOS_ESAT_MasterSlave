/*
 * ESAT_Slave.c
 *
 *  Created on: 16.12.2024 г.
 *      Author: MLM1SF
 */

#include <stdlib.h>
/* Standard includes. */
#include <stdio.h>
#include <time.h>
#include "ESAT_Slave.h"

static enum en_SlaveStates SlaveState = S_INIT;
static uint32_t ESAT_Error = ESAT_S_OK;

static enum en_SlaveStates ESAT_StateDecision(uint32_t Condition)
{
	uint32_t randValue = 0u;
	enum en_SlaveStates lState = S_INIT;
	srand(Condition);
	randValue = rand()%Condition;
	if(0u != (randValue % 4))
	{
		lState = ACTIVE;
	}
	else
	{
		lState = SLEEP;
	}
	return lState;
}

static enum en_SlaveStates ESAT_ReturnState(void)
{
	return SlaveState;
}

static uint32_t ESAT_DoOperation(void* Op)
{
	uint32_t lResult = ESAT_S_NOT_OK;

	if(NULL!= Op)
	{
		if(1u == (*((uint32_t*)Op)) % 3)
		{
			lResult = ESAT_S_OK;
		}
	}

	return lResult;
}

static uint32_t ESAT_ReportError(void)
{
	return ESAT_Error;
}

static uint32_t ESAT_SlaveOperation(uint32_t ReqOp, void* Op)
{
	uint32_t lResult = ESAT_S_NOT_OK;

	if( GET_STATUS == ReqOp)
	{
		lResult = (uint32_t)ESAT_ReturnState();
	}
	else if(GET_OP_RESULT == ReqOp)
	{
		lResult = ESAT_DoOperation(Op);
	}
	else if(GET_ERROR == ReqOp)
	{
		lResult = ESAT_ReportError();
	}
	else
	{
		lResult = ESAT_S_OK;
	}
	return lResult;
}



/*
 * ESAT_Slave()
 * Represent Device B
 *
 * */
int ESAT_Slave(uint32_t Trigger, uint32_t RequestOp)
{
	uint32_t lResult = 0u;
	SlaveState = ESAT_StateDecision(Trigger);

	switch(SlaveState)
	{
	case ACTIVE:
		lResult = ESAT_SlaveOperation(RequestOp, (void*)&Trigger);
	break;

	case SLEEP:

	break;

	case FAULT:
		ESAT_Error = ESAT_ERROR_SYNC;
	break;

	default:
		printf( "ESAT_Slave no matching case \r\n" );
		ESAT_Error = ESAT_ERROR_INV;
	break;
	}
	return lResult;
}


